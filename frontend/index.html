<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ứng Dụng Đặt Vé Xem Phim</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.22.9/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.4.0/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 400px;
            text-align: center;
        }

        .modal.show {
            display: flex;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [token, setToken] = useState(localStorage.getItem('token') || '');
            const [userRole, setUserRole] = useState(localStorage.getItem('role') || '');
            const [isLoggedIn, setIsLoggedIn] = useState(!!token);
            const [registerData, setRegisterData] = useState({
                firstName: '', lastName: '', username: '', email: '', password: '', phone: '', address: ''
            });
            const [loginData, setLoginData] = useState({ email: '', password: '' });
            const [forgotPasswordEmail, setForgotPasswordEmail] = useState('');
            const [bookingData, setBookingData] = useState({ movieId: '', seatNumber: '', showtimeId: '' });
            const [theaterData, setTheaterData] = useState({ name: '', location: '', capacity: '', seats: [] });
            const [showtimeData, setShowtimeData] = useState({
                movieId: '', theaterId: '', startTime: ''
            });
            const [movies, setMovies] = useState([]);
            const [myBookings, setMyBookings] = useState([]);
            const [allBookings, setAllBookings] = useState([]);
            const [theaters, setTheaters] = useState([]);
            const [showtimes, setShowtimes] = useState([]);
            const [selectedTheater, setSelectedTheater] = useState('');
            const [message, setMessage] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const [showModal, setShowModal] = useState(false);
            const [modalMessage, setModalMessage] = useState('');
            const [showAuthTab, setShowAuthTab] = useState('login');
            const [showAdminTab, setShowAdminTab] = useState('theater');

            const showMessage = (msg) => {
                setModalMessage(msg);
                setShowModal(true);
                setTimeout(() => setShowModal(false), 3000);
            };

            // Hàm tạo danh sách ghế dựa trên capacity (giống backend)
            const generateSeats = (capacity) => {
                const seats = [];
                const rows = Math.ceil(capacity / 10); // Mỗi hàng 10 ghế
                const rowLetters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');

                for (let i = 0; i < rows; i++) {
                    const rowLetter = rowLetters[i];
                    const seatsInRow = Math.min(10, capacity - i * 10);
                    for (let j = 1; j <= seatsInRow; j++) {
                        seats.push(`${rowLetter}${j}`);
                    }
                }
                return seats;
            };

            const handleRegister = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                try {
                    const response = await axios.post('http://localhost:8080/auth/register', {
                        ...registerData,
                        role: 'user'
                    }, {
                        headers: { 'Content-Type': 'application/json' }
                    });
                    showMessage('Đăng ký thành công! Vui lòng đăng nhập.');
                    setShowAuthTab('login');
                    setRegisterData({ firstName: '', lastName: '', username: '', email: '', password: '', phone: '', address: '' });
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Đăng ký thất bại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleLogin = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                try {
                    const response = await axios.post('http://localhost:8080/auth/login', loginData, {
                        headers: { 'Content-Type': 'application/json' }
                    });
                    const { token } = response.data;
                    const decodedToken = JSON.parse(atob(token.split('.')[1]));
                    const role = decodedToken.role;
                    setToken(token);
                    setUserRole(role);
                    setIsLoggedIn(true);
                    localStorage.setItem('token', token);
                    localStorage.setItem('role', role);
                    showMessage('Đăng nhập thành công!');
                    setLoginData({ email: '', password: '' });
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Đăng nhập thất bại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleForgotPassword = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                try {
                    await axios.post('http://localhost:8080/auth/forgot-password', { email: forgotPasswordEmail });
                    showMessage('Link đặt lại mật khẩu đã được gửi đến email của bạn!');
                    setForgotPasswordEmail('');
                    setShowAuthTab('login');
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Không thể gửi yêu cầu. Vui lòng thử lại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleLogout = () => {
                setToken('');
                setUserRole('');
                setIsLoggedIn(false);
                localStorage.removeItem('token');
                localStorage.removeItem('role');
                setMyBookings([]);
                setAllBookings([]);
                setTheaters([]);
                setShowtimes([]);
                setMovies([]);
                showMessage('Đăng xuất thành công.');
            };

            const handleAddTheater = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                try {
                    const response = await axios.post('http://localhost:8080/theater/', theaterData, {
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${token}`
                        }
                    });
                    showMessage('Thêm rạp thành công!');
                    setTheaterData({ name: '', location: '', capacity: '', seats: [] });
                    fetchTheaters();
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Thêm rạp thất bại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleAddShowtime = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                try {
                    const response = await axios.post('http://localhost:8080/showtime/', showtimeData, {
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${token}`
                        }
                    });
                    showMessage('Thêm suất chiếu thành công!');
                    setShowtimeData({ movieId: '', theaterId: '', startTime: '' });
                    fetchShowtimes(selectedTheater);
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Thêm suất chiếu thất bại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleConfirmBooking = async (bookingId) => {
                setIsLoading(true);
                try {
                    const response = await axios.post('http://localhost:8080/booking-ticket/confirm', { bookingId }, {
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${token}`
                        }
                    });
                    showMessage('Xác nhận vé thành công!');
                    fetchMyBookings(token);
                    if (userRole === 'admin') fetchAllBookings(token);
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Xác nhận vé thất bại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleBooking = async (e) => {
                e.preventDefault();
                if (!bookingData.showtimeId || !bookingData.seatNumber) {
                    showMessage('Vui lòng chọn suất chiếu và ghế ngồi.');
                    return;
                }
                setIsLoading(true);
                try {
                    const selectedShowtime = showtimes.find(s => s._id === bookingData.showtimeId);
                    const payload = {
                        showtimeId: bookingData.showtimeId,
                        seatNumber: bookingData.seatNumber,
                        movieId: selectedShowtime?.movieId || ''
                    };
                    const response = await axios.post('http://localhost:8080/booking-ticket/create', payload, {
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: `Bearer ${token}`
                        }
                    });
                    showMessage('Đặt vé thành công! Vui lòng xác nhận trong 1 phút.');
                    fetchMyBookings(token);
                    setBookingData({ movieId: '', seatNumber: '', showtimeId: '' });
                    fetchShowtimes(selectedTheater);
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Đặt vé thất bại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const handleCancelBooking = async (bookingId) => {
                setIsLoading(true);
                try {
                    await axios.put(`http://localhost:8080/booking-ticket/cancel/${bookingId}`, {}, {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    showMessage('Hủy vé thành công.');
                    fetchMyBookings(token);
                    if (userRole === 'admin') fetchAllBookings(token);
                    await fetchShowtimes(selectedTheater);
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Hủy vé thất bại.');
                } finally {
                    setIsLoading(false);
                }
            };

            const fetchTheaters = async () => {
                setIsLoading(true);
                try {
                    const response = await axios.get('http://localhost:8080/theater/', {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    setTheaters(response.data || []);
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Không thể tải danh sách rạp.');
                } finally {
                    setIsLoading(false);
                }
            };

            const fetchMovies = async () => {
                setIsLoading(true);
                try {
                    const response = await axios.get('http://localhost:8080/movie/', {
                        headers: { Authorization: `Bearer ${token}` }
                    });
                    setMovies(response.data || []);
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Không thể tải danh sách phim.');
                    setMovies([]);
                } finally {
                    setIsLoading(false);
                }
            };

            const fetchShowtimes = async (theaterId) => {
                setIsLoading(true);
                try {
                    const url = theaterId ? `http://localhost:8080/showtime/?theaterId=${theaterId}` : 'http://localhost:8080/showtime/';
                    const response = await axios.get(url, {
                        headers: {
                            'Content-Type': 'application/json',
                            Authorization: token ? `Bearer ${token}` : undefined
                        }
                    });
                    setShowtimes(response.data || []);
                    if (response.data.length === 0) {
                        showMessage('Không có suất chiếu nào cho rạp này.');
                    }
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Không thể tải danh sách suất chiếu.');
                    setShowtimes([]);
                } finally {
                    setIsLoading(false);
                }
            };

            const fetchMyBookings = async (tokenToUse) => {
                if (!tokenToUse) {
                    showMessage('Vui lòng đăng nhập lại.');
                    return;
                }
                setIsLoading(true);
                try {
                    const response = await axios.get('http://localhost:8080/booking-ticket/my-bookings', {
                        headers: { Authorization: `Bearer ${tokenToUse}` }
                    });
                    setMyBookings(response.data.bookings || []);
                    if (response.data.bookings.length === 0) {
                        showMessage('Không có vé nào được đặt.');
                    }
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Không thể tải danh sách vé.');
                } finally {
                    setIsLoading(false);
                }
            };

            const fetchAllBookings = async (tokenToUse) => {
                setIsLoading(true);
                try {
                    const response = await axios.get('http://localhost:8080/booking-ticket/all-bookings', {
                        headers: { Authorization: `Bearer ${tokenToUse}` }
                    });
                    setAllBookings(response.data || []);
                } catch (error) {
                    showMessage(error.response?.data?.message || 'Không thể tải tất cả vé.');
                } finally {
                    setIsLoading(false);
                }
            };

            useEffect(() => {
                if (token) {
                    setIsLoggedIn(true);
                    fetchTheaters();
                    fetchMovies();
                    fetchMyBookings(token);
                    if (userRole === 'admin') fetchAllBookings(token);
                } else {
                    setIsLoggedIn(false);
                    setMyBookings([]);
                    setAllBookings([]);
                    setTheaters([]);
                    setShowtimes([]);
                    setMovies([]);
                }
            }, [token, userRole]);

            useEffect(() => {
                fetchShowtimes(selectedTheater);
            }, [selectedTheater]);

            return (
                <div className="flex flex-col min-h-screen">
                    <header className="bg-blue-600 text-white py-4">
                        <div className="container mx-auto px-4 flex justify-between items-center">
                            <h1 className="text-2xl font-bold">Ứng Dụng Đặt Vé Xem Phim</h1>
                            <nav>
                                {isLoggedIn ? (
                                    <>
                                        {userRole === 'admin' && (
                                            <button
                                                onClick={() => setShowAdminTab('theater')}
                                                className="px-4 py-2 bg-blue-700 rounded-lg hover:bg-blue-800 mr-2"
                                            >
                                                Quản Trị
                                            </button>
                                        )}
                                        <button
                                            onClick={handleLogout}
                                            className="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600"
                                        >
                                            Đăng Xuất
                                        </button>
                                    </>
                                ) : (
                                    <>
                                        <button
                                            onClick={() => setShowAuthTab('login')}
                                            className="px-4 py-2 bg-blue-700 rounded-lg hover:bg-blue-800 mr-2"
                                        >
                                            Đăng Nhập
                                        </button>
                                        <button
                                            onClick={() => setShowAuthTab('register')}
                                            className="px-4 py-2 bg-blue-700 rounded-lg hover:bg-blue-800"
                                        >
                                            Đăng Ký
                                        </button>
                                    </>
                                )}
                            </nav>
                        </div>
                    </header>

                    <main className="container mx-auto px-4 py-8 flex-grow">
                        {isLoading && <div className="spinner mx-auto mb-4"></div>}
                        {message && <p className="text-red-500 mb-4 text-center">{message}</p>}

                        {!isLoggedIn ? (
                            <div className="max-w-md mx-auto bg-white rounded-lg shadow-lg p-8">
                                <div className="flex justify-center mb-6">
                                    <button
                                        onClick={() => setShowAuthTab('login')}
                                        className={`px-4 py-2 text-lg font-semibold ${showAuthTab === 'login' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'} rounded-l-lg`}
                                    >
                                        Đăng Nhập
                                    </button>
                                    <button
                                        onClick={() => setShowAuthTab('register')}
                                        className={`px-4 py-2 text-lg font-semibold ${showAuthTab === 'register' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'} rounded-r-lg`}
                                    >
                                        Đăng Ký
                                    </button>
                                </div>

                                {showAuthTab === 'login' && (
                                    <form onSubmit={handleLogin} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Email</label>
                                            <input
                                                type="email"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập email"
                                                value={loginData.email}
                                                onChange={(e) => setLoginData({ ...loginData, email: e.target.value })}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Mật khẩu</label>
                                            <input
                                                type="password"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập mật khẩu"
                                                value={loginData.password}
                                                onChange={(e) => setLoginData({ ...loginData, password: e.target.value })}
                                                required
                                            />
                                        </div>
                                        <button
                                            type="button"
                                            onClick={() => setShowAuthTab('forgot')}
                                            className="text-sm text-blue-500 hover:underline"
                                        >
                                            Quên mật khẩu?
                                        </button>
                                        <button
                                            type="submit"
                                            className="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600"
                                            disabled={isLoading}
                                        >
                                            {isLoading ? 'Đang xử lý...' : 'Đăng Nhập'}
                                        </button>
                                    </form>
                                )}

                                {showAuthTab === 'register' && (
                                    <form onSubmit={handleRegister} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Họ</label>
                                            <input
                                                type="text"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập họ"
                                                value={registerData.firstName}
                                                onChange={(e) => setRegisterData({ ...registerData, firstName: e.target.value })}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Tên</label>
                                            <input
                                                type="text"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập tên"
                                                value={registerData.lastName}
                                                onChange={(e) => setRegisterData({ ...registerData, lastName: e.target.value })}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Tên đăng nhập</label>
                                            <input
                                                type="text"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập tên đăng nhập"
                                                value={registerData.username}
                                                onChange={(e) => setRegisterData({ ...registerData, username: e.target.value })}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Email</label>
                                            <input
                                                type="email"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập email"
                                                value={registerData.email}
                                                onChange={(e) => setRegisterData({ ...registerData, email: e.target.value })}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Mật khẩu</label>
                                            <input
                                                type="password"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập mật khẩu"
                                                value={registerData.password}
                                                onChange={(e) => setRegisterData({ ...registerData, password: e.target.value })}
                                                required
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Số điện thoại</label>
                                            <input
                                                type="text"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập số điện thoại"
                                                value={registerData.phone}
                                                onChange={(e) => setRegisterData({ ...registerData, phone: e.target.value })}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Địa chỉ</label>
                                            <input
                                                type="text"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập địa chỉ"
                                                value={registerData.address}
                                                onChange={(e) => setRegisterData({ ...registerData, address: e.target.value })}
                                            />
                                        </div>
                                        <button
                                            type="submit"
                                            className="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600"
                                            disabled={isLoading}
                                        >
                                            {isLoading ? 'Đang xử lý...' : 'Đăng Ký'}
                                        </button>
                                    </form>
                                )}

                                {showAuthTab === 'forgot' && (
                                    <form onSubmit={handleForgotPassword} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Email</label>
                                            <input
                                                type="email"
                                                className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                placeholder="Nhập email để đặt lại mật khẩu"
                                                value={forgotPasswordEmail}
                                                onChange={(e) => setForgotPasswordEmail(e.target.value)}
                                                required
                                            />
                                        </div>
                                        <button
                                            type="submit"
                                            className="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600"
                                            disabled={isLoading}
                                        >
                                            {isLoading ? 'Đang xử lý...' : 'Gửi Link Đặt Lại'}
                                        </button>
                                        <button
                                            type="button"
                                            onClick={() => setShowAuthTab('login')}
                                            className="text-sm text-blue-500 hover:underline"
                                        >
                                            Quay lại đăng nhập
                                        </button>
                                    </form>
                                )}
                            </div>
                        ) : (
                            <div>
                                <h2 className="text-2xl font-bold mb-4">
                                    Chào mừng, {userRole === 'admin' ? 'Quản trị viên' : 'Người dùng'}!
                                </h2>

                                {userRole === 'admin' && (
                                    <div className="mb-8 p-4 bg-white rounded-lg shadow">
                                        <h3 className="text-xl font-semibold mb-2">Bảng Quản Trị</h3>
                                        <div className="flex justify-center mb-6">
                                            <button
                                                onClick={() => setShowAdminTab('theater')}
                                                className={`px-4 py-2 text-lg font-semibold ${showAdminTab === 'theater' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'} rounded-l-lg`}
                                            >
                                                Thêm Rạp
                                            </button>
                                            <button
                                                onClick={() => setShowAdminTab('showtime')}
                                                className={`px-4 py-2 text-lg font-semibold ${showAdminTab === 'showtime' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700'} rounded-r-lg`}
                                            >
                                                Thêm Suất Chiếu
                                            </button>
                                        </div>

                                        {showAdminTab === 'theater' && (
                                            <form onSubmit={handleAddTheater} className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700">Tên rạp</label>
                                                    <input
                                                        type="text"
                                                        className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                        placeholder="Nhập tên rạp (VD: Cinema 2)"
                                                        value={theaterData.name}
                                                        onChange={(e) => setTheaterData({ ...theaterData, name: e.target.value })}
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700">Địa điểm</label>
                                                    <input
                                                        type="text"
                                                        className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                        placeholder="Nhập địa điểm (VD: 123 Main St)"
                                                        value={theaterData.location}
                                                        onChange={(e) => setTheaterData({ ...theaterData, location: e.target.value })}
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700">Sức chứa</label>
                                                    <input
                                                        type="number"
                                                        className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                        placeholder="Nhập sức chứa (VD: 100)"
                                                        value={theaterData.capacity}
                                                        onChange={(e) => {
                                                            const capacity = parseInt(e.target.value) || 0;
                                                            const seats = generateSeats(capacity);
                                                            setTheaterData({ ...theaterData, capacity, seats });
                                                        }}
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700">Danh sách ghế (xem trước)</label>
                                                    <p className="mt-1 text-sm text-gray-600">{theaterData.seats.join(', ')}</p>
                                                </div>
                                                <button
                                                    type="submit"
                                                    className="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600"
                                                    disabled={isLoading}
                                                >
                                                    {isLoading ? 'Đang xử lý...' : 'Thêm Rạp'}
                                                </button>
                                            </form>
                                        )}

                                        {showAdminTab === 'showtime' && (
                                            <form onSubmit={handleAddShowtime} className="space-y-4">
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700">Movie ID</label>
                                                    <input
                                                        type="text"
                                                        className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                        placeholder="Nhập Movie ID (VD: MOV004)"
                                                        value={showtimeData.movieId}
                                                        onChange={(e) => setShowtimeData({ ...showtimeData, movieId: e.target.value })}
                                                        required
                                                    />
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700">Rạp</label>
                                                    <select
                                                        className="w-full border p-2 rounded"
                                                        value={showtimeData.theaterId}
                                                        onChange={(e) => setShowtimeData({ ...showtimeData, theaterId: e.target.value })}
                                                        required
                                                    >
                                                        <option value="">Chọn rạp</option>
                                                        {theaters.map(theater => (
                                                            <option key={theater._id} value={theater._id}>
                                                                {theater.name} - {theater.location}
                                                            </option>
                                                        ))}
                                                    </select>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700">Thời gian bắt đầu</label>
                                                    <input
                                                        type="datetime-local"
                                                        className="mt-1 w-full px-4 py-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500"
                                                        value={showtimeData.startTime}
                                                        onChange={(e) => setShowtimeData({ ...showtimeData, startTime: e.target.value })}
                                                        required
                                                    />
                                                </div>
                                                <button
                                                    type="submit"
                                                    className="w-full bg-blue-500 text-white py-2 rounded-lg hover:bg-blue-600"
                                                    disabled={isLoading}
                                                >
                                                    {isLoading ? 'Đang xử lý...' : 'Thêm Suất Chiếu'}
                                                </button>
                                            </form>
                                        )}
                                    </div>
                                )}

                                <div className="mb-8 p-4 bg-white rounded-lg shadow">
                                    <h3 className="text-xl font-semibold mb-2">Chọn Rạp</h3>
                                    {theaters.length > 0 ? (
                                        <select
                                            className="w-full border p-2 rounded"
                                            value={selectedTheater}
                                            onChange={(e) => setSelectedTheater(e.target.value)}
                                        >
                                            <option value="">Tất cả rạp</option>
                                            {theaters.map(theater => (
                                                <option key={theater._id} value={theater._id}>
                                                    {theater.name} - {theater.location}
                                                </option>
                                            ))}
                                        </select>
                                    ) : (
                                        <p>Không tìm thấy rạp nào.</p>
                                    )}
                                </div>

                                <div className="mb-8 p-4 bg-white rounded-lg shadow">
                                    <h3 className="text-xl font-semibold mb-2">Suất Chiếu</h3>
                                    {showtimes.length > 0 ? (
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {showtimes.map(showtime => (
                                                <div key={showtime._id} className="p-4 border rounded">
                                                    <p><strong>Phim:</strong> {showtime.movieId}</p>
                                                    <p><strong>Rạp:</strong> {theaters.find(t => t._id === showtime.theaterId)?.name || 'N/A'}</p>
                                                    <p><strong>Thời gian:</strong> {new Date(showtime.startTime).toLocaleString()}</p>
                                                    <p><strong>Ghế trống:</strong> {showtime.availableSeats.join(', ')}</p>
                                                    <p><strong>Ghế đã đặt:</strong> {showtime.bookedSeats.join(', ') || 'Chưa có'}</p>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p>Không có suất chiếu nào.</p>
                                    )}
                                </div>

                                <div className="mb-8 p-4 bg-white rounded-lg shadow">
                                    <h3 className="text-xl font-semibold mb-2">Đặt Vé</h3>
                                    <form onSubmit={handleBooking} className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Chọn suất chiếu</label>
                                            <select
                                                className="w-full border p-2 rounded"
                                                value={bookingData.showtimeId}
                                                onChange={(e) => setBookingData({ ...bookingData, showtimeId: e.target.value, seatNumber: '' })}
                                                required
                                            >
                                                <option value="">Chọn suất chiếu</option>
                                                {showtimes.map(showtime => (
                                                    <option key={showtime._id} value={showtime._id}>
                                                        Phim: {showtime.movieId} | {new Date(showtime.startTime).toLocaleString()}
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700">Chọn ghế</label>
                                            <select
                                                className="w-full border p-2 rounded"
                                                value={bookingData.seatNumber}
                                                onChange={(e) => setBookingData({ ...bookingData, seatNumber: e.target.value })}
                                                disabled={!bookingData.showtimeId || !showtimes.find(s => s._id === bookingData.showtimeId)?.availableSeats?.length}
                                                required
                                            >
                                                <option value="">Chọn ghế</option>
                                                {bookingData.showtimeId && showtimes.find(s => s._id === bookingData.showtimeId)?.availableSeats?.map(seat => (
                                                    <option key={seat} value={seat}>{seat}</option>
                                                ))}
                                            </select>
                                        </div>
                                        <button
                                            type="submit"
                                            className={`w-full py-2 rounded text-white ${bookingData.showtimeId && bookingData.seatNumber ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-400 cursor-not-allowed'}`}
                                            disabled={!bookingData.showtimeId || !bookingData.seatNumber || isLoading}
                                        >
                                            {isLoading ? 'Đang xử lý...' : 'Đặt Vé'}
                                        </button>
                                    </form>
                                </div>

                                <div className="mb-8 p-4 bg-white rounded-lg shadow">
                                    <h3 className="text-xl font-semibold mb-2">Vé Của Tôi</h3>
                                    {myBookings.length > 0 ? (
                                        <div className="space-y-2">
                                            {myBookings.map(booking => (
                                                <div key={booking._id} className="flex justify-between items-center p-2 border-b">
                                                    <div>
                                                        <p><strong>Phim:</strong> {booking.movieId || 'N/A'}</p>
                                                        <p><strong>Ghế:</strong> {booking.seatNumber || 'N/A'}</p>
                                                        <p><strong>Ngày đặt:</strong> {new Date(booking.bookingDate).toLocaleString()}</p>
                                                        <p><strong>Trạng thái:</strong> {booking.status || 'N/A'}</p>
                                                    </div>
                                                    <div className="flex space-x-2">
                                                        {booking.status === 'pending' && (
                                                            <button
                                                                onClick={() => handleConfirmBooking(booking._id)}
                                                                className="bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600"
                                                                disabled={isLoading}
                                                            >
                                                                Xác nhận
                                                            </button>
                                                        )}
                                                        <button
                                                            onClick={() => handleCancelBooking(booking._id)}
                                                            className="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600"
                                                            disabled={isLoading || booking.status === 'cancelled'}
                                                        >
                                                            Hủy
                                                        </button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    ) : (
                                        <p>Không có vé nào được đặt.</p>
                                    )}
                                </div>

                                {userRole === 'admin' && (
                                    <div className="p-4 bg-white rounded-lg shadow">
                                        <h3 className="text-xl font-semibold mb-2">Tất Cả Vé (Quản Trị Viên)</h3>
                                        {allBookings.length > 0 ? (
                                            <div className="space-y-2">
                                                {allBookings.map(booking => (
                                                    <div key={booking._id} className="p-2 border-b">
                                                        <p><strong>Người dùng:</strong> {booking.userId || 'N/A'}</p>
                                                        <p><strong>Phim:</strong> {booking.movieId || 'N/A'}</p>
                                                        <p><strong>Ghế:</strong> {booking.seatNumber || 'N/A'}</p>
                                                        <p><strong>Ngày đặt:</strong> {new Date(booking.bookingDate).toLocaleString()}</p>
                                                        <p><strong>Trạng thái:</strong> {booking.status || 'N/A'}</p>
                                                    </div>
                                                ))}
                                            </div>
                                        ) : (
                                            <p>Không có vé nào.</p>
                                        )}
                                    </div>
                                )}
                            </div>
                        )}
                    </main>

                    <footer className="bg-gray-800 text-white py-4">
                        <div className="container mx-auto px-4 text-center">
                            <p>© 2025 Ứng Dụng Đặt Vé Xem Phim. All rights reserved.</p>
                        </div>
                    </footer>

                    <div className={`modal ${showModal ? 'show' : ''}`}>
                        <div className="modal-content">
                            <p>{modalMessage}</p>
                            <button
                                onClick={() => setShowModal(false)}
                                className="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
                            >
                                Đóng
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>